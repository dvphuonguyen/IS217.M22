select customer_type, name, max_adr
from [dbo].[Customer] a join (	select a.id_customer_type, customer_type, max(adr) max_adr
								from [dbo].[CustomerType] a join [dbo].[Customer] b on b.id_customer_type = a.id_customer_type
										join [dbo].[FactHotelBooking] c on b.id_customer = c.id_customer 
										join [dbo].[ArrivalTime] d on d.id_arrival_date = c.id_arrival_date
								where arrival_date_year = 2017
								group by a.id_customer_type, customer_type
							) b on a.id_customer_type = b.id_customer_type 
		join [dbo].[FactHotelBooking] c on a.id_customer = c.id_customer 
		join [dbo].[ArrivalTime] d on d.id_arrival_date = c.id_arrival_date
where arrival_date_year = 2017 and adr = max_adr

